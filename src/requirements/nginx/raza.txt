FROM debian:bullseye

#installation of Nginx
RUN apt-get update && apt-get install -y nginx && rm -rf /var/lib/apt/lists/*
RUN apt-get update && apt-get install -y openssl

# RUN openssl req -new -newkey rsa:2048 -nodes \
#     -keyout /etc/ssl/private/ssl_certificate.key \
#     -out /etc/ssl/certs/ssl_certificate.crt \
#     -subj "/C=JP/ST=Tokyo/L=city/O=42tokyo/CN=sraza.42.fr"

RUN openssl req -new -newkey rsa:2048 -nodes \
    -keyout /etc/ssl/private/ssl_certificate.key \
    -out /etc/ssl/certs/ssl_certificate.csr \
    -subj "/C=JP/ST=Tokyo/L=city/O=42tokyo/CN=sraza.42.fr"

COPY --from=0 /etc/ssl/private/ssl_certificate.key /etc/nginx/ssl/
COPY --from=0 /etc/ssl/certs/ssl_certificate.crt /etc/nginx/ssl/

#設定ファイルのコピー
RUN mkdir -p /var/www/html
RUN mkdir -p /etc/nginx/logs/nginx/
COPY nginx.conf /etc/nginx/sites-available/default
# COPY nginx.conf /etc/nginx/nginx.conf

# SSL証明書と秘密鍵をコピー
# COPY ssl/ssl_certificate.crt /etc/nginx/ssl/
# COPY ssl/ssl_certificate.key /etc/nginx/ssl/

# COPY index.html /var/www/html/
COPY sraza.html /var/www/html/sraza.html
# COPY 404.html /var/www/html/
# COPY 50x.html /var/www/html/


EXPOSE 80 443

CMD ["nginx", "-g", "daemon off;"]
